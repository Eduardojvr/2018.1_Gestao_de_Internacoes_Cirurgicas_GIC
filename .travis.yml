sudo: required

language: python
python:
  - "3.6.4"
services:
  - docker
before_install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y install docker-ce
  - sudo pip install docker-compose
  - pip install -r requirements.txt
before_script:
  - sudo docker-compose -f docker-compose.yml up --d


script:
  - python manage.py makemigrations --noinput
  - python manage.py migrate
  - coverage run -m django test --settings=tests.settings
  - docker-compose down

after_success:
  - coveralls

after_script:
  - docker-compose down

deploy:
  provider: heroku
  api_key: 
    secure: "D467iDXA1yxc0fxo4985qKhKbVmXcEgb0427KwQnh4J0cLuabdeUjxv+4qnyjzVuPa0frDIIqQA8KtiWE2Tlp13I+Yf6SecHRRVsdHCJVAs2CH86g2Gg28HepEirZwnt65zjwLFi2/btBf2Va1bcPXJEroSSaDRz6d4qREO4r9prwTh/HnPHJGKlTXrJjsC6aFU9kDovAKQjx+f/dKwlsGSKhdFzpsI2EH8M5t6f4xajvAIeUUYcQ0Y2/tIz9yBgNUnZVsXThqzLPjsjEOwxJXji9JdE1HCdGpW2p9eSOSYHH+rp+7I0SCbwB5vQz34NKVswZ4Xp4PyrE2r0BorHTDRRWhLiRropthRnoKyV6synE4qrK57HsBpwhrcQQ8yWInnxEA+jiXwwKhQVFmhY/lSwM0micSv6BzRax5vOf4wLkqat7Nk4fYu2hN+JP9BpC2VABDKBbEgxjNgUf8EwzU2csdF4Tl/JzReqYA+T39q2C3jKjmtLtplb/KrR7qYWiz2EKbnb0jbX7gXpNN+WGMWm/ELZO3WZgWIf9YSHleSkM0kU7bWeJsCa3IgdvyxvDXa7uKtx7GGDnycrxzkUx6VtQmjiEkJ2HEXASyY3Wt+NXD6yhgoBtDmOrb833NECMkrwYFT8PlocEQDMoa+yxmPcxiJYKnT5Bk7XSdcQ5D4="
  app:
    development: gicsaude
    master: gerenciamais
