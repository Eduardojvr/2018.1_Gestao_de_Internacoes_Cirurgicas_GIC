sudo: required

language: python
python:
  - "3.6.4"
services:
  - docker
before_install:
  - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
  - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
  - sudo apt-get update
  - sudo apt-get -y install docker-ce
  - sudo pip install docker-compose
  - pip install -r requirements.txt
before_script:
  - sudo docker-compose -f docker-compose.yml up --d


script:
  - python manage.py makemigrations --noinput
  - python manage.py migrate
  - coverage run -m django test --settings=tests.settings
  - docker-compose down

after_success:
  - coveralls

after_script:
  - docker-compose down

deploy:
  provider: heroku
  api_key:
    secure: "ZuVTrmAiXU+/0RR8V2QzglNJ7XZ3McND35/LRVa4KKkZqJfzbhkBfUp9gieufqyTpQM4y+AixJyc4T4kEOwhqJ06wFE/QG7jRe75LEz8tWZnl+Ul41PvuEcqIgqDLh2c3h1EaB2dtFC/pBlA2nv9Hq4paGcsmQ63bmLgWOCoF6dWyhPyCJYtV70xEOfQi5ABiz7y7UWH5zhNrkkpbMiqAIoNeBqdtdkqv1DxZV51fTvd1j7PiDutoR1+ggbDekZ2Qp0ltM86wJ1YHBL3/66KpeyUhi/lsZo992/z9GauXizAMXmUlMfQG5llHrkelFE/B8HZa8TVqxRuGGmuy+VwzlbTtmhiBrUSfLzPJtuq4D7F2bNTv+6qZ2k4aVlAM2ZKlIWSf+8DxfaAk3vPJbXKuFnJpDq6tHBGs6//irm++e01K0zpMmyLzehr3fZQNR468Z7jFxE9WNrjlh5LMrhWuYVTzTxmZWxSgatv1rm0AWSdeYvzpYsq4/CdUzrlswETti0mScXxBq9xj6NNBqPpkTqGiFJIpAt6TVQVE/w131vm6cfQW0+McJ43OfDLjiA8/yN9AGA15ldxhKCJWeePEPukCut6fB+aes2jvemktxSr8zXBu4gLivD0UnnKwi92jTc4PwqWoUbiIAg2mo2vzVj+MzpKWnxyYOCjFoc13YM="
  app:
    development: gicsaude
    master: gerenciamais
